<script language="javascript" src="p5.js"></script>
<script language="javascript" src="../build/ijeomamotion.js"></script>
<script language="javascript">
var angles = [30, 10, 45, 35, 60, 38, 75, 67];
var rotation = 270;
var pieArcs = [];

function setup() {
    createCanvas(720, 400);
    noStroke();
    angleMode(DEGREES);

    createPieChart(300, angles)

    s = new MOTION.Sequence();

    var a = rotation;

    var i
    for (i = 0; i < pieArcs.length; i++) {
        var pa = pieArcs[i]
        a -= (i > 0) ? (angles[i - 1] / 2 + angles[i] / 2) : angles[i] / 2;

        var t = new MOTION.Tween(pa, 50)
            .add('offset', 0)
            .add('alpha', 255)
            .onStart(function(window, object) {
                object.offset = 100;
                object.alpha = 0;
            })

        s.add(new MOTION.Tween(this, 'rotation', a, 50));
        s.add(t);
        s.add(new MOTION.Tween(this, 'rotation', a, 50));
    }

    s.setTimeScale(3).play()
}

function draw() {
    background(100);

    text(s.getTime(), 25, 25)

    drawPieChart()
}

function mouseDragged() {
    s.seek(mouseX / width)
}

function keyTyped() {
    if (key == 'a')
        s.pause();
    else if (key == 's')
        s.resume();
    else if (key == 'd')
        s.play();
    else if (key == 'f')
        s.stop();
}
PieArc = function(id, x, y, d, a1, a2, c, a) {
    this.id = id;
    this.x = x;
    this.y = y;
    this.offset = 0;
    this.d = d;
    this.a1 = a1;
    this.a2 = a2;
    this.color = c;
    this.alpha = 0;
    this.draw = function() {
        // stroke(255,this.alpha);
        // fill(0,this.alpha) 
        noStroke()
        fill(this.color, this.alpha)
        push();
        translate(this.x, this.y)
        rotate(rotation + this.a2)
        translate(this.offset * cos(this.a1 / 2), this.offset * sin(this.a1 / 2))
        arc(0, 0, this.d, this.d, 0, radians(this.a1), PIE);
        pop();
    };
    return this;
}
createPieChart = function(diameter, data) {
    var lastAngle = 0;
    for (var i = 0; i < data.length; i++) {
        var gray = (i < 0) ? 255 : map(i, 0, data.length, 0, 255);
        pieArcs.push(new PieArc(i, width / 2, height / 2, diameter, angles[i], lastAngle, gray));
        lastAngle += angles[i];
    }
}
drawPieChart = function() {
    push();
    for (var i = 0; i < pieArcs.length; i++)
        pieArcs[i].draw();
    pop();
}
</script>
<style>
body {
    padding: 0;
}
</style>
<!-- this line removes any default padding -->
</head>

<body>
</body>