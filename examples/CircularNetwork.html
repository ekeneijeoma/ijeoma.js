<script language="javascript" src="p5.js"></script>
<script language="javascript" src="../build/ijeomamotion.js"></script>
<script language="javascript">
var nodes = [];
var circleCount = 6;
var circleOffset = 40;

function setup() {
    createCanvas(512, 512);

    strokeWeight(.25)

    for (var i = 0; i < 75; i++) {
        var n = new Node(10, round(random(1, circleCount)) * circleOffset, color(random(255), random(255), random(255)), 255)

        var duration = round(random(500, 750));
        var endAngle = n.angle + ((round(random(100)) % 2 == 0) ? -TWO_PI : TWO_PI);
        var endRadius = n.radius - circleOffset; //round(random(circleCount))*circleOffset

        n.angleTween = new MOTION.Tween(duration).add(n, 'angle', endAngle).repeat().play();
        n.radiusTween = new MOTION.Tween(100, 0, Quad.easeBoth).add(n, 'radius', endRadius).repeat().reverse().play()

        nodes.push(n)
    }
}

function draw() {
    background(255)

    fill(0)
    text(round(frameRate()), 25, 25);

    translate(width / 2, height / 2);

    stroke(0, 50)

    for (var i = 0; i < nodes.length; i++)
        for (var j = 0; j < nodes.length; j++) {
            var dx = nodes[j].x - nodes[i].x
            var dy = nodes[j].y - nodes[i].y

            if (dx * dx + dy * dy < circleOffset * circleOffset * 2) {
                beginShape();
                // stroke(nodes[i].color)
                vertex(nodes[i].x, nodes[i].y)
                // stroke(nodes[j].color)
                vertex(nodes[j].x, nodes[j].y)
                endShape();
            }
        }

    for (var i = 0; i < nodes.length; i++)
        nodes[i].draw()
}

function mousePressed() {
    for (var i = 0; i < nodes.length; i++)
        nodes[i].angleTween.pause();
}

function mouseDragged() {
    for (var i = 0; i < nodes.length; i++)
        nodes[i].angleTween.seek(mouseX / width);
}

function mouseReleased() {
    for (var i = 0; i < nodes.length; i++)
        nodes[i].angleTween.resume();
}

Node = function(s, r, color, alpha, tween) {
    this.x = 0;
    this.y = 0;
    this.size = s;
    this.radius = r;
    this.angle = random(TWO_PI);
    this.color = color;
    this.alpha = alpha;
    this.tween = tween

    this.draw = function() {
        this.x = cos(this.angle) * this.radius;
        this.y = sin(this.angle) * this.radius;

        noStroke();
        fill(this.color, this.alpha);
        ellipse(this.x, this.y, this.size, this.size);
    }

    return this;
}
</script>
<style>
body {
    padding: 0;
}
</style>
</head>

<body>
</body>